<div class="qr-container">
    <div class="row h-100 m-0">

        <div class="col-md-7 d-flex flex-column align-items-center justify-content-center p-4">

            <h2 class="fw-bold text-primary mb-3">Control de Asistencia</h2>

            <div class="camera-frame shadow-lg">

                <div class="camera-overlay" *ngIf="!cameraActiva">
                    <span>CÁMARA APAGADA</span>
                </div>

                <div class="camera-overlay loading-overlay" *ngIf="cameraActiva && action.isLoading">
                    <div class="spinner-border text-light" role="status"></div>
                    <span class="ms-2">Iniciando...</span>
                </div>

                <ngx-scanner-qrcode #action="scanner" (event)="onEvent($event)" [isBeep]="false">
                </ngx-scanner-qrcode>
            </div>

            <div class="status-card mt-4 shadow-sm" [ngClass]="{
                  'bg-info': tipoMensaje === 'info',
                  'bg-success': tipoMensaje === 'success',
                  'bg-danger': tipoMensaje === 'error'
                }">
                <h3 class="text-white text-center m-0 py-3 fs-5">
                    {{ mensaje }}
                </h3>
            </div>

            <div class="mt-4 d-flex gap-2 flex-wrap justify-content-center">

                <button class="btn btn-outline-primary" (click)="toggleCamera()">
                    <i class="bi bi-camera-video"></i>
                    {{ cameraActiva ? 'Apagar' : 'Encender' }}
                </button>

                <button class="btn btn-outline-secondary" (click)="cambiarCamara()" [disabled]="cameras.length <= 1">
                    <i class="bi bi-arrow-repeat"></i> Cambiar
                </button>

                <button class="btn btn-outline-danger" (click)="salir()">
                    <i class="bi bi-box-arrow-left"></i> Salir
                </button>
            </div>
        </div>

        <div class="col-md-5 bg-white p-4 shadow-start scrollable-list">
            <h4 class="text-muted mb-4 border-bottom pb-2">Últimos Registros</h4>

            <div *ngIf="ultimosRegistros.length === 0" class="text-center text-muted mt-5">
                <i class="bi bi-clock-history fs-1"></i>
                <p>Esperando alumnos...</p>
            </div>

            <div *ngFor="let reg of ultimosRegistros" class="card mb-3 border-0 shadow-sm animate__fadeInLeft">
                <div class="card-body d-flex align-items-center">
                    <div class="avatar-circle me-3">
                        {{ reg.alumno.charAt(0) }}
                    </div>
                    <div class="flex-grow-1">
                        <h6 class="mb-0 fw-bold">{{ reg.alumno }}</h6>
                        <small class="text-muted">{{ reg.hora }}</small>
                    </div>
                    <span class="badge" [ngClass]="{
                          'bg-success': reg.situacion === 'PUNTUAL',
                          'bg-warning text-dark': reg.situacion === 'TARDE'
                        }">
                        {{ reg.situacion }}
                    </span>
                </div>
            </div>
        </div>

    </div>
</div>